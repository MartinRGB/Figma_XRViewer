/******/ (() => { // webpackBootstrap
var __webpack_exports__ = {};
/*!********************************!*\
  !*** ./src/plugin/xrviewer.ts ***!
  \********************************/
var exportScale = 1;
function sendMsg(tp, val) {
  figma.ui.postMessage({
    type: tp,
    value: val
  });
}

// Method I
function getImg() {
  var nodes = figma.currentPage.selection;
  if (nodes.length > 0) {
    var node = nodes[0];
    var img = node.exportAsync({
      contentsOnly: true,
      format: "PNG",
      constraint: {
        type: "SCALE",
        value: exportScale
      }
    });
    return img;
  } else {
    return false;
  }
}
function postImage() {
  var img = getImg();
  if (img) {
    img.then(function (img) {
      sendMsg("selection", img);
    });
  } else {
    sendMsg("msg", "No frame has been selected");
  }
}

// todo,mutiple selection
var selectionName = '';

// Method II
function postImagePromise() {
  var nodes = figma.currentPage.selection;
  var dataArray = [];
  var index = 0;
  // todo,mutiple selection
  //sendMsg("isFigmaEnv",true)
  if (nodes.length === 1) {
    var frameNode = nodes[0];
    selectionName = frameNode.name;
    // todo
    for (var c = 0; c < frameNode.children.length; c++) {
      frameNode.children[c].visible = false;
    }
    frameNode.exportAsync({
      contentsOnly: true,
      format: "PNG",
      constraint: {
        type: "SCALE",
        value: exportScale
      }
    }).then(function (resolved) {
      dataArray.push({
        name: frameNode.name,
        width: frameNode.width,
        height: frameNode.height,
        x: frameNode.x,
        y: frameNode.y,
        imageData: resolved,
        type: 'image-framenode',
        index: index
      });
      console.log("Succeed to send frameNode image!");
      var _loop = function _loop(i) {
        frameNode.children[i].visible = true;
        frameNode.children[i].exportAsync({
          contentsOnly: true,
          format: "PNG",
          constraint: {
            type: "SCALE",
            value: exportScale
          }
        }).then(function (resolved) {
          dataArray.push({
            name: frameNode.children[i].name,
            width: frameNode.children[i].width,
            height: frameNode.children[i].height,
            x: frameNode.children[i].x,
            y: frameNode.children[i].y,
            imageData: resolved,
            type: 'image-childnode',
            index: ++index
          });
          console.log("Succeed to send childNode image!");
          if (i === frameNode.children.length - 1) {
            console.log('last childNode image!');
            sendMsg("selection", {
              isFigma: true,
              data: dataArray
            });
          }
        }, function (rejected) {
          console.error(rejected);
          sendMsg("failed", null);
          console.error("Failed to send image!");
          throw new Error('Failed to send image!');
        });
      };
      for (var i = 0; i < frameNode.children.length; i++) {
        _loop(i);
      }
    }, function (rejected) {
      console.error(rejected);
      sendMsg("failed", null);
      console.error("Failed to send image!");
      throw new Error('Failed to send image!');
    });
  } else if (nodes.length > 1) {
    sendMsg("failed", null);
    console.error("Only support one frame!");
    throw new Error('Only support one frame!');
  } else {
    sendMsg("failed", null);
    console.error("No frame has been selected!");
    throw new Error('No frame has been selected');
  }
}
figma.showUI(__html__, {
  width: 900,
  height: 675
});
postImagePromise();
figma.ui.onmessage = function (msg) {
  if (msg.type === 'save-canvas-image') {
    // let data = msg.blob as Uint8Array
    var data = msg.blob;
    var imageHash = figma.createImage(data).hash;
    var rect = figma.createRectangle();
    console.log(msg);
    rect.name = msg.name;
    rect.resize(msg.width, msg.height);
    rect.fills = [{
      type: "IMAGE",
      scaleMode: "FIT",
      imageHash: imageHash
    }];
    figma.currentPage.appendChild(rect);
    figma.currentPage.selection = [rect];
    //figma.viewport.scrollAndZoomIntoView([rect]);
  }

  if (msg.type === 'cancel') {
    figma.closePlugin();
  }
};
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c0NvbnRlbnQiOlsiY29uc3QgZXhwb3J0U2NhbGUgPSAxO1xuXG5mdW5jdGlvbiBzZW5kTXNnKHRwLHZhbCkge1xuICAgIGZpZ21hLnVpLnBvc3RNZXNzYWdlKHt0eXBlOiB0cCwgdmFsdWU6dmFsfSk7XG59XG5cblxuLy8gTWV0aG9kIElcbmZ1bmN0aW9uIGdldEltZygpIHtcbiAgICBsZXQgbm9kZXMgPSBmaWdtYS5jdXJyZW50UGFnZS5zZWxlY3Rpb247XG4gICAgaWYgKG5vZGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBub2RlID0gbm9kZXNbMF0gXG4gICAgICBsZXQgaW1nID0gbm9kZS5leHBvcnRBc3luYyh7XG4gICAgICAgIGNvbnRlbnRzT25seTogdHJ1ZSxcbiAgICAgICAgZm9ybWF0OiBcIlBOR1wiLFxuICAgICAgICBjb25zdHJhaW50OiB7XG4gICAgICAgICAgICB0eXBlOiBcIlNDQUxFXCIsXG4gICAgICAgICAgICB2YWx1ZTogZXhwb3J0U2NhbGUsXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICByZXR1cm4gaW1nXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbn1cblxuZnVuY3Rpb24gcG9zdEltYWdlKCl7XG5cbiAgICBsZXQgaW1nID0gZ2V0SW1nKCk7XG4gICAgaWYgKGltZykge1xuICAgICAgaW1nLnRoZW4oKGltZykgPT4ge1xuICAgICAgICBzZW5kTXNnKFwic2VsZWN0aW9uXCIsaW1nKTtcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbmRNc2coXCJtc2dcIixcIk5vIGZyYW1lIGhhcyBiZWVuIHNlbGVjdGVkXCIpO1xuICAgIH1cbn1cblxuXG4vLyB0b2RvLG11dGlwbGUgc2VsZWN0aW9uXG52YXIgc2VsZWN0aW9uTmFtZSA9ICcnO1xuXG4vLyBNZXRob2QgSUlcbmZ1bmN0aW9uIHBvc3RJbWFnZVByb21pc2UoKXtcbiAgICBsZXQgbm9kZXMgPSBmaWdtYS5jdXJyZW50UGFnZS5zZWxlY3Rpb247XG4gICAgY29uc3QgZGF0YUFycmF5ID0gW107XG4gICAgdmFyIGluZGV4ID0gMDtcbiAgICAvLyB0b2RvLG11dGlwbGUgc2VsZWN0aW9uXG4gICAgLy9zZW5kTXNnKFwiaXNGaWdtYUVudlwiLHRydWUpXG4gICAgaWYgKG5vZGVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgXG4gICAgICAgIGxldCBmcmFtZU5vZGUgPSBub2Rlc1swXSBcbiAgICAgICAgc2VsZWN0aW9uTmFtZSA9IGZyYW1lTm9kZS5uYW1lO1xuICAgICAgICAvLyB0b2RvXG4gICAgICAgIGZvcih2YXIgYz0wO2M8ZnJhbWVOb2RlLmNoaWxkcmVuLmxlbmd0aDtjKyspe1xuICAgICAgICAgIGZyYW1lTm9kZS5jaGlsZHJlbltjXS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnJhbWVOb2RlLmV4cG9ydEFzeW5jKHtcbiAgICAgICAgICBjb250ZW50c09ubHk6IHRydWUsXG4gICAgICAgICAgZm9ybWF0OiBcIlBOR1wiLFxuICAgICAgICAgIGNvbnN0cmFpbnQ6IHtcbiAgICAgICAgICAgICAgdHlwZTogXCJTQ0FMRVwiLFxuICAgICAgICAgICAgICB2YWx1ZTogZXhwb3J0U2NhbGUsXG4gICAgICAgICAgfVxuICAgICAgICB9KS50aGVuKFxuICAgICAgICAgIHJlc29sdmVkID0+IHtcbiAgICAgICAgICAgICAgZGF0YUFycmF5LnB1c2goXG4gICAgICAgICAgICAgICAgeyBcbiAgICAgICAgICAgICAgICAgIG5hbWU6ZnJhbWVOb2RlLm5hbWUsXG4gICAgICAgICAgICAgICAgICB3aWR0aDpmcmFtZU5vZGUud2lkdGgsXG4gICAgICAgICAgICAgICAgICBoZWlnaHQ6ZnJhbWVOb2RlLmhlaWdodCxcbiAgICAgICAgICAgICAgICAgIHg6ZnJhbWVOb2RlLngsXG4gICAgICAgICAgICAgICAgICB5OmZyYW1lTm9kZS55LFxuICAgICAgICAgICAgICAgICAgaW1hZ2VEYXRhOnJlc29sdmVkLFxuICAgICAgICAgICAgICAgICAgdHlwZTonaW1hZ2UtZnJhbWVub2RlJyxcbiAgICAgICAgICAgICAgICAgIGluZGV4OmluZGV4XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU3VjY2VlZCB0byBzZW5kIGZyYW1lTm9kZSBpbWFnZSFcIilcbiAgICAgICAgICAgICAgZm9yKGxldCBpPTA7aTxmcmFtZU5vZGUuY2hpbGRyZW4ubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICAgICAgZnJhbWVOb2RlLmNoaWxkcmVuW2ldLnZpc2libGUgPSB0cnVlXG4gICAgICAgICAgICAgICAgZnJhbWVOb2RlLmNoaWxkcmVuW2ldLmV4cG9ydEFzeW5jKHtcbiAgICAgICAgICAgICAgICAgIGNvbnRlbnRzT25seTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIGZvcm1hdDogXCJQTkdcIixcbiAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIlNDQUxFXCIsXG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGV4cG9ydFNjYWxlLFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pLnRoZW4oIFxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZWQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBkYXRhQXJyYXkucHVzaChcbiAgICAgICAgICAgICAgICAgICAgICB7IFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTpmcmFtZU5vZGUuY2hpbGRyZW5baV0ubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOmZyYW1lTm9kZS5jaGlsZHJlbltpXS53aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDpmcmFtZU5vZGUuY2hpbGRyZW5baV0uaGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICAgICAgeDpmcmFtZU5vZGUuY2hpbGRyZW5baV0ueCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6ZnJhbWVOb2RlLmNoaWxkcmVuW2ldLnksXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZURhdGE6cmVzb2x2ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOidpbWFnZS1jaGlsZG5vZGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6KytpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTdWNjZWVkIHRvIHNlbmQgY2hpbGROb2RlIGltYWdlIVwiKVxuICAgICAgICAgICAgICAgICAgICBpZihpID09PSBmcmFtZU5vZGUuY2hpbGRyZW4ubGVuZ3RoIC0xKXtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbGFzdCBjaGlsZE5vZGUgaW1hZ2UhJylcbiAgICAgICAgICAgICAgICAgICAgICBzZW5kTXNnKFwic2VsZWN0aW9uXCIse2lzRmlnbWE6dHJ1ZSxkYXRhOmRhdGFBcnJheX0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgcmVqZWN0ZWQgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihyZWplY3RlZClcbiAgICAgICAgICAgICAgICAgIHNlbmRNc2coXCJmYWlsZWRcIixudWxsKTtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc2VuZCBpbWFnZSFcIilcbiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHNlbmQgaW1hZ2UhJyk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVqZWN0ZWQgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHJlamVjdGVkKVxuICAgICAgICAgICAgICBzZW5kTXNnKFwiZmFpbGVkXCIsbnVsbCk7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc2VuZCBpbWFnZSFcIilcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gc2VuZCBpbWFnZSEnKTtcbiAgICAgICAgfSlcbiAgICB9XG4gICAgZWxzZSBpZihub2Rlcy5sZW5ndGggPiAxKXtcbiAgICAgIHNlbmRNc2coXCJmYWlsZWRcIixudWxsKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJPbmx5IHN1cHBvcnQgb25lIGZyYW1lIVwiKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdPbmx5IHN1cHBvcnQgb25lIGZyYW1lIScpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc2VuZE1zZyhcImZhaWxlZFwiLG51bGwpO1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiTm8gZnJhbWUgaGFzIGJlZW4gc2VsZWN0ZWQhXCIpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gZnJhbWUgaGFzIGJlZW4gc2VsZWN0ZWQnKTtcbiAgICB9XG59XG5cbmZpZ21hLnNob3dVSShfX2h0bWxfXyx7d2lkdGg6OTAwLGhlaWdodDo2NzV9KTtcbnBvc3RJbWFnZVByb21pc2UoKTtcblxuZmlnbWEudWkub25tZXNzYWdlID0gKG1zZykgPT4ge1xuXG4gICAgaWYobXNnLnR5cGUgPT09J3NhdmUtY2FudmFzLWltYWdlJyl7XG4gICAgICAgIC8vIGxldCBkYXRhID0gbXNnLmJsb2IgYXMgVWludDhBcnJheVxuICAgICAgICBsZXQgZGF0YSA9IG1zZy5ibG9iXG4gICAgICAgIGxldCBpbWFnZUhhc2ggPSBmaWdtYS5jcmVhdGVJbWFnZShkYXRhKS5oYXNoXG4gICAgICAgIGNvbnN0IHJlY3QgPSBmaWdtYS5jcmVhdGVSZWN0YW5nbGUoKVxuICAgICAgICBjb25zb2xlLmxvZyhtc2cpXG4gICAgICAgIHJlY3QubmFtZSA9IG1zZy5uYW1lO1xuICAgICAgICByZWN0LnJlc2l6ZShtc2cud2lkdGgsbXNnLmhlaWdodClcbiAgICAgICAgcmVjdC5maWxscyA9IFtcbiAgICAgICAgICAgIHsgdHlwZTogXCJJTUFHRVwiLCBzY2FsZU1vZGU6IFwiRklUXCIsICBpbWFnZUhhc2ggfSxcbiAgICAgICAgXVxuICAgICAgICBmaWdtYS5jdXJyZW50UGFnZS5hcHBlbmRDaGlsZChyZWN0KVxuICAgICAgICBmaWdtYS5jdXJyZW50UGFnZS5zZWxlY3Rpb24gPSBbcmVjdF07XG4gICAgICAgIC8vZmlnbWEudmlld3BvcnQuc2Nyb2xsQW5kWm9vbUludG9WaWV3KFtyZWN0XSk7XG4gICAgfVxuICAgIGlmKG1zZy50eXBlID09PSdjYW5jZWwnKXtcbiAgICAgICAgZmlnbWEuY2xvc2VQbHVnaW4oKTtcbiAgICB9XG5cbn07XG5cbiJdLCJuYW1lcyI6WyJleHBvcnRTY2FsZSIsInNlbmRNc2ciLCJ0cCIsInZhbCIsImZpZ21hIiwidWkiLCJwb3N0TWVzc2FnZSIsInR5cGUiLCJ2YWx1ZSIsImdldEltZyIsIm5vZGVzIiwiY3VycmVudFBhZ2UiLCJzZWxlY3Rpb24iLCJsZW5ndGgiLCJub2RlIiwiaW1nIiwiZXhwb3J0QXN5bmMiLCJjb250ZW50c09ubHkiLCJmb3JtYXQiLCJjb25zdHJhaW50IiwicG9zdEltYWdlIiwidGhlbiIsInNlbGVjdGlvbk5hbWUiLCJwb3N0SW1hZ2VQcm9taXNlIiwiZGF0YUFycmF5IiwiaW5kZXgiLCJmcmFtZU5vZGUiLCJuYW1lIiwiYyIsImNoaWxkcmVuIiwidmlzaWJsZSIsInJlc29sdmVkIiwicHVzaCIsIndpZHRoIiwiaGVpZ2h0IiwieCIsInkiLCJpbWFnZURhdGEiLCJjb25zb2xlIiwibG9nIiwiaSIsImlzRmlnbWEiLCJkYXRhIiwicmVqZWN0ZWQiLCJlcnJvciIsIkVycm9yIiwic2hvd1VJIiwiX19odG1sX18iLCJvbm1lc3NhZ2UiLCJtc2ciLCJibG9iIiwiaW1hZ2VIYXNoIiwiY3JlYXRlSW1hZ2UiLCJoYXNoIiwicmVjdCIsImNyZWF0ZVJlY3RhbmdsZSIsInJlc2l6ZSIsImZpbGxzIiwic2NhbGVNb2RlIiwiYXBwZW5kQ2hpbGQiLCJjbG9zZVBsdWdpbiJdLCJzb3VyY2VSb290IjoiIn0=