/******/ (() => { // webpackBootstrap
var __webpack_exports__ = {};
/*!********************************!*\
  !*** ./src/plugin/xrviewer.ts ***!
  \********************************/
var exportScale = 1;
function sendMsg(tp, val) {
  figma.ui.postMessage({
    type: tp,
    value: val
  });
}

// Method I
function getImg() {
  var nodes = figma.currentPage.selection;
  if (nodes.length > 0) {
    var node = nodes[0];
    var img = node.exportAsync({
      contentsOnly: true,
      format: "PNG",
      constraint: {
        type: "SCALE",
        value: exportScale
      }
    });
    return img;
  } else {
    return false;
  }
}
function postImage() {
  var img = getImg();
  if (img) {
    img.then(function (img) {
      sendMsg("selection", img);
    });
  } else {
    sendMsg("msg", "No frame has been selected");
  }
}

// todo,mutiple selection
var selectionName = '';

// Method II
function postImagePromise() {
  var nodes = figma.currentPage.selection;
  var dataArray = [];
  var index = 0;
  // todo,mutiple selection
  //sendMsg("isFigmaEnv",true)
  if (nodes.length === 1) {
    var frameNode = nodes[0];
    selectionName = frameNode.name;
    // todo
    for (var c = 0; c < frameNode.children.length; c++) {
      frameNode.children[c].visible = false;
    }
    frameNode.exportAsync({
      contentsOnly: true,
      format: "PNG",
      constraint: {
        type: "SCALE",
        value: exportScale
      }
    }).then(function (resolved) {
      dataArray.push({
        name: frameNode.name,
        width: frameNode.width,
        height: frameNode.height,
        x: frameNode.x,
        y: frameNode.y,
        imageData: resolved,
        type: 'image-framenode',
        index: index
      });
      console.log("Succeed to send frameNode image!");
      var _loop = function _loop(i) {
        frameNode.children[i].visible = true;
        frameNode.children[i].exportAsync({
          contentsOnly: true,
          format: "PNG",
          constraint: {
            type: "SCALE",
            value: exportScale
          }
        }).then(function (resolved) {
          dataArray.push({
            name: frameNode.children[i].name,
            width: frameNode.children[i].width,
            height: frameNode.children[i].height,
            x: frameNode.children[i].x,
            y: frameNode.children[i].y,
            imageData: resolved,
            type: 'image-childnode',
            index: ++index
          });
          console.log("Succeed to send childNode image!");
          if (i === frameNode.children.length - 1) {
            console.log('last childNode image!');
            sendMsg("selection", {
              isFigma: true,
              data: dataArray
            });
          }
        }, function (rejected) {
          console.error(rejected);
          sendMsg("failed", null);
          console.error("Failed to send image!");
          throw new Error('Failed to send image!');
        });
      };
      for (var i = 0; i < frameNode.children.length; i++) {
        _loop(i);
      }
    }, function (rejected) {
      console.error(rejected);
      sendMsg("failed", null);
      console.error("Failed to send image!");
      throw new Error('Failed to send image!');
    });
  } else if (nodes.length > 1) {
    sendMsg("failed", null);
    console.error("Only support one frame!");
    throw new Error('Only support one frame!');
  } else {
    sendMsg("failed", null);
    console.error("No frame has been selected!");
    throw new Error('No frame has been selected');
  }
}
figma.showUI(__html__, {
  width: 900,
  height: 675
});
postImagePromise();
figma.ui.onmessage = function (msg) {
  if (msg.type === 'save-canvas-image') {
    // let data = msg.blob as Uint8Array
    var data = msg.blob;
    var imageHash = figma.createImage(data).hash;
    var rect = figma.createRectangle();
    console.log(msg);
    rect.name = msg.name;
    rect.resize(msg.width, msg.height);
    rect.fills = [{
      type: "IMAGE",
      scaleMode: "FIT",
      imageHash: imageHash
    }];
    figma.currentPage.appendChild(rect);
    figma.currentPage.selection = [rect];
    //figma.viewport.scrollAndZoomIntoView([rect]);
  }

  if (msg.type === 'cancel') {
    figma.closePlugin();
  }
};
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZS5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLElBQU1BLFdBQVcsR0FBRyxDQUFDO0FBRXJCLFNBQVNDLE9BQU8sQ0FBQ0MsRUFBRSxFQUFDQyxHQUFHLEVBQUU7RUFDckJDLEtBQUssQ0FBQ0MsRUFBRSxDQUFDQyxXQUFXLENBQUM7SUFBQ0MsSUFBSSxFQUFFTCxFQUFFO0lBQUVNLEtBQUssRUFBQ0w7RUFBRyxDQUFDLENBQUM7QUFDL0M7O0FBR0E7QUFDQSxTQUFTTSxNQUFNLEdBQUc7RUFDZCxJQUFJQyxLQUFLLEdBQUdOLEtBQUssQ0FBQ08sV0FBVyxDQUFDQyxTQUFTO0VBQ3ZDLElBQUlGLEtBQUssQ0FBQ0csTUFBTSxHQUFHLENBQUMsRUFBRTtJQUNwQixJQUFJQyxJQUFJLEdBQUdKLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDbkIsSUFBSUssR0FBRyxHQUFHRCxJQUFJLENBQUNFLFdBQVcsQ0FBQztNQUN6QkMsWUFBWSxFQUFFLElBQUk7TUFDbEJDLE1BQU0sRUFBRSxLQUFLO01BQ2JDLFVBQVUsRUFBRTtRQUNSWixJQUFJLEVBQUUsT0FBTztRQUNiQyxLQUFLLEVBQUVSO01BQ1g7SUFDRixDQUFDLENBQUM7SUFDRixPQUFPZSxHQUFHO0VBQ1osQ0FBQyxNQUFNO0lBQ0wsT0FBTyxLQUFLO0VBQ2Q7QUFDSjtBQUVBLFNBQVNLLFNBQVMsR0FBRTtFQUVoQixJQUFJTCxHQUFHLEdBQUdOLE1BQU0sRUFBRTtFQUNsQixJQUFJTSxHQUFHLEVBQUU7SUFDUEEsR0FBRyxDQUFDTSxJQUFJLENBQUMsVUFBQ04sR0FBRyxFQUFLO01BQ2hCZCxPQUFPLENBQUMsV0FBVyxFQUFDYyxHQUFHLENBQUM7SUFDMUIsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxNQUFNO0lBQ0xkLE9BQU8sQ0FBQyxLQUFLLEVBQUMsNEJBQTRCLENBQUM7RUFDN0M7QUFDSjs7QUFHQTtBQUNBLElBQUlxQixhQUFhLEdBQUcsRUFBRTs7QUFFdEI7QUFDQSxTQUFTQyxnQkFBZ0IsR0FBRTtFQUN2QixJQUFJYixLQUFLLEdBQUdOLEtBQUssQ0FBQ08sV0FBVyxDQUFDQyxTQUFTO0VBQ3ZDLElBQU1ZLFNBQVMsR0FBRyxFQUFFO0VBQ3BCLElBQUlDLEtBQUssR0FBRyxDQUFDO0VBQ2I7RUFDQTtFQUNBLElBQUlmLEtBQUssQ0FBQ0csTUFBTSxLQUFLLENBQUMsRUFBRTtJQUVwQixJQUFJYSxTQUFTLEdBQUdoQixLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ3hCWSxhQUFhLEdBQUdJLFNBQVMsQ0FBQ0MsSUFBSTtJQUM5QjtJQUNBLEtBQUksSUFBSUMsQ0FBQyxHQUFDLENBQUMsRUFBQ0EsQ0FBQyxHQUFDRixTQUFTLENBQUNHLFFBQVEsQ0FBQ2hCLE1BQU0sRUFBQ2UsQ0FBQyxFQUFFLEVBQUM7TUFDMUNGLFNBQVMsQ0FBQ0csUUFBUSxDQUFDRCxDQUFDLENBQUMsQ0FBQ0UsT0FBTyxHQUFHLEtBQUs7SUFDdkM7SUFDQUosU0FBUyxDQUFDVixXQUFXLENBQUM7TUFDcEJDLFlBQVksRUFBRSxJQUFJO01BQ2xCQyxNQUFNLEVBQUUsS0FBSztNQUNiQyxVQUFVLEVBQUU7UUFDUlosSUFBSSxFQUFFLE9BQU87UUFDYkMsS0FBSyxFQUFFUjtNQUNYO0lBQ0YsQ0FBQyxDQUFDLENBQUNxQixJQUFJLENBQ0wsVUFBQVUsUUFBUSxFQUFJO01BQ1JQLFNBQVMsQ0FBQ1EsSUFBSSxDQUNaO1FBQ0VMLElBQUksRUFBQ0QsU0FBUyxDQUFDQyxJQUFJO1FBQ25CTSxLQUFLLEVBQUNQLFNBQVMsQ0FBQ08sS0FBSztRQUNyQkMsTUFBTSxFQUFDUixTQUFTLENBQUNRLE1BQU07UUFDdkJDLENBQUMsRUFBQ1QsU0FBUyxDQUFDUyxDQUFDO1FBQ2JDLENBQUMsRUFBQ1YsU0FBUyxDQUFDVSxDQUFDO1FBQ2JDLFNBQVMsRUFBQ04sUUFBUTtRQUNsQnhCLElBQUksRUFBQyxpQkFBaUI7UUFDdEJrQixLQUFLLEVBQUNBO01BQ1IsQ0FBQyxDQUNGO01BQ0RhLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLGtDQUFrQyxDQUFDO01BQUEsMkJBQ3ZDQyxDQUFDO1FBQ1BkLFNBQVMsQ0FBQ0csUUFBUSxDQUFDVyxDQUFDLENBQUMsQ0FBQ1YsT0FBTyxHQUFHLElBQUk7UUFDcENKLFNBQVMsQ0FBQ0csUUFBUSxDQUFDVyxDQUFDLENBQUMsQ0FBQ3hCLFdBQVcsQ0FBQztVQUNoQ0MsWUFBWSxFQUFFLElBQUk7VUFDbEJDLE1BQU0sRUFBRSxLQUFLO1VBQ2JDLFVBQVUsRUFBRTtZQUNSWixJQUFJLEVBQUUsT0FBTztZQUNiQyxLQUFLLEVBQUVSO1VBQ1g7UUFDRixDQUFDLENBQUMsQ0FBQ3FCLElBQUksQ0FDTCxVQUFBVSxRQUFRLEVBQUk7VUFDVlAsU0FBUyxDQUFDUSxJQUFJLENBQ1o7WUFDRUwsSUFBSSxFQUFDRCxTQUFTLENBQUNHLFFBQVEsQ0FBQ1csQ0FBQyxDQUFDLENBQUNiLElBQUk7WUFDL0JNLEtBQUssRUFBQ1AsU0FBUyxDQUFDRyxRQUFRLENBQUNXLENBQUMsQ0FBQyxDQUFDUCxLQUFLO1lBQ2pDQyxNQUFNLEVBQUNSLFNBQVMsQ0FBQ0csUUFBUSxDQUFDVyxDQUFDLENBQUMsQ0FBQ04sTUFBTTtZQUNuQ0MsQ0FBQyxFQUFDVCxTQUFTLENBQUNHLFFBQVEsQ0FBQ1csQ0FBQyxDQUFDLENBQUNMLENBQUM7WUFDekJDLENBQUMsRUFBQ1YsU0FBUyxDQUFDRyxRQUFRLENBQUNXLENBQUMsQ0FBQyxDQUFDSixDQUFDO1lBQ3pCQyxTQUFTLEVBQUNOLFFBQVE7WUFDbEJ4QixJQUFJLEVBQUMsaUJBQWlCO1lBQ3RCa0IsS0FBSyxFQUFDLEVBQUVBO1VBQ1YsQ0FBQyxDQUNGO1VBQ0RhLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLGtDQUFrQyxDQUFDO1VBQy9DLElBQUdDLENBQUMsS0FBS2QsU0FBUyxDQUFDRyxRQUFRLENBQUNoQixNQUFNLEdBQUUsQ0FBQyxFQUFDO1lBQ3BDeUIsT0FBTyxDQUFDQyxHQUFHLENBQUMsdUJBQXVCLENBQUM7WUFDcEN0QyxPQUFPLENBQUMsV0FBVyxFQUFDO2NBQUN3QyxPQUFPLEVBQUMsSUFBSTtjQUFDQyxJQUFJLEVBQUNsQjtZQUFTLENBQUMsQ0FBQztVQUNwRDtRQUNKLENBQUMsRUFBRSxVQUFBbUIsUUFBUSxFQUFJO1VBQ2JMLE9BQU8sQ0FBQ00sS0FBSyxDQUFDRCxRQUFRLENBQUM7VUFDdkIxQyxPQUFPLENBQUMsUUFBUSxFQUFDLElBQUksQ0FBQztVQUN0QnFDLE9BQU8sQ0FBQ00sS0FBSyxDQUFDLHVCQUF1QixDQUFDO1VBQ3RDLE1BQU0sSUFBSUMsS0FBSyxDQUFDLHVCQUF1QixDQUFDO1FBQzFDLENBQUMsQ0FBQztNQUFBO01BakNKLEtBQUksSUFBSUwsQ0FBQyxHQUFDLENBQUMsRUFBQ0EsQ0FBQyxHQUFDZCxTQUFTLENBQUNHLFFBQVEsQ0FBQ2hCLE1BQU0sRUFBQzJCLENBQUMsRUFBRSxFQUFDO1FBQUEsTUFBcENBLENBQUM7TUFrQ1Q7SUFDSixDQUFDLEVBQ0QsVUFBQUcsUUFBUSxFQUFJO01BQ1JMLE9BQU8sQ0FBQ00sS0FBSyxDQUFDRCxRQUFRLENBQUM7TUFDdkIxQyxPQUFPLENBQUMsUUFBUSxFQUFDLElBQUksQ0FBQztNQUN0QnFDLE9BQU8sQ0FBQ00sS0FBSyxDQUFDLHVCQUF1QixDQUFDO01BQ3RDLE1BQU0sSUFBSUMsS0FBSyxDQUFDLHVCQUF1QixDQUFDO0lBQzlDLENBQUMsQ0FBQztFQUNOLENBQUMsTUFDSSxJQUFHbkMsS0FBSyxDQUFDRyxNQUFNLEdBQUcsQ0FBQyxFQUFDO0lBQ3ZCWixPQUFPLENBQUMsUUFBUSxFQUFDLElBQUksQ0FBQztJQUN0QnFDLE9BQU8sQ0FBQ00sS0FBSyxDQUFDLHlCQUF5QixDQUFDO0lBQ3hDLE1BQU0sSUFBSUMsS0FBSyxDQUFDLHlCQUF5QixDQUFDO0VBQzVDLENBQUMsTUFDSTtJQUNENUMsT0FBTyxDQUFDLFFBQVEsRUFBQyxJQUFJLENBQUM7SUFDdEJxQyxPQUFPLENBQUNNLEtBQUssQ0FBQyw2QkFBNkIsQ0FBQztJQUM1QyxNQUFNLElBQUlDLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQztFQUNqRDtBQUNKO0FBRUF6QyxLQUFLLENBQUMwQyxNQUFNLENBQUNDLFFBQVEsRUFBQztFQUFDZCxLQUFLLEVBQUMsR0FBRztFQUFDQyxNQUFNLEVBQUM7QUFBRyxDQUFDLENBQUM7QUFDN0NYLGdCQUFnQixFQUFFO0FBRWxCbkIsS0FBSyxDQUFDQyxFQUFFLENBQUMyQyxTQUFTLEdBQUcsVUFBQ0MsR0FBRyxFQUFLO0VBRTFCLElBQUdBLEdBQUcsQ0FBQzFDLElBQUksS0FBSSxtQkFBbUIsRUFBQztJQUMvQjtJQUNBLElBQUltQyxJQUFJLEdBQUdPLEdBQUcsQ0FBQ0MsSUFBSTtJQUNuQixJQUFJQyxTQUFTLEdBQUcvQyxLQUFLLENBQUNnRCxXQUFXLENBQUNWLElBQUksQ0FBQyxDQUFDVyxJQUFJO0lBQzVDLElBQU1DLElBQUksR0FBR2xELEtBQUssQ0FBQ21ELGVBQWUsRUFBRTtJQUNwQ2pCLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDVSxHQUFHLENBQUM7SUFDaEJLLElBQUksQ0FBQzNCLElBQUksR0FBR3NCLEdBQUcsQ0FBQ3RCLElBQUk7SUFDcEIyQixJQUFJLENBQUNFLE1BQU0sQ0FBQ1AsR0FBRyxDQUFDaEIsS0FBSyxFQUFDZ0IsR0FBRyxDQUFDZixNQUFNLENBQUM7SUFDakNvQixJQUFJLENBQUNHLEtBQUssR0FBRyxDQUNUO01BQUVsRCxJQUFJLEVBQUUsT0FBTztNQUFFbUQsU0FBUyxFQUFFLEtBQUs7TUFBR1AsU0FBUyxFQUFUQTtJQUFVLENBQUMsQ0FDbEQ7SUFDRC9DLEtBQUssQ0FBQ08sV0FBVyxDQUFDZ0QsV0FBVyxDQUFDTCxJQUFJLENBQUM7SUFDbkNsRCxLQUFLLENBQUNPLFdBQVcsQ0FBQ0MsU0FBUyxHQUFHLENBQUMwQyxJQUFJLENBQUM7SUFDcEM7RUFDSjs7RUFDQSxJQUFHTCxHQUFHLENBQUMxQyxJQUFJLEtBQUksUUFBUSxFQUFDO0lBQ3BCSCxLQUFLLENBQUN3RCxXQUFXLEVBQUU7RUFDdkI7QUFFSixDQUFDLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9YUlZpZXdlci8uL3NyYy9wbHVnaW4veHJ2aWV3ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwb3J0U2NhbGUgPSAxO1xyXG5cclxuZnVuY3Rpb24gc2VuZE1zZyh0cCx2YWwpIHtcclxuICAgIGZpZ21hLnVpLnBvc3RNZXNzYWdlKHt0eXBlOiB0cCwgdmFsdWU6dmFsfSk7XHJcbn1cclxuXHJcblxyXG4vLyBNZXRob2QgSVxyXG5mdW5jdGlvbiBnZXRJbWcoKSB7XHJcbiAgICBsZXQgbm9kZXMgPSBmaWdtYS5jdXJyZW50UGFnZS5zZWxlY3Rpb247XHJcbiAgICBpZiAobm9kZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBsZXQgbm9kZSA9IG5vZGVzWzBdIFxyXG4gICAgICBsZXQgaW1nID0gbm9kZS5leHBvcnRBc3luYyh7XHJcbiAgICAgICAgY29udGVudHNPbmx5OiB0cnVlLFxyXG4gICAgICAgIGZvcm1hdDogXCJQTkdcIixcclxuICAgICAgICBjb25zdHJhaW50OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFwiU0NBTEVcIixcclxuICAgICAgICAgICAgdmFsdWU6IGV4cG9ydFNjYWxlLFxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgcmV0dXJuIGltZ1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBvc3RJbWFnZSgpe1xyXG5cclxuICAgIGxldCBpbWcgPSBnZXRJbWcoKTtcclxuICAgIGlmIChpbWcpIHtcclxuICAgICAgaW1nLnRoZW4oKGltZykgPT4ge1xyXG4gICAgICAgIHNlbmRNc2coXCJzZWxlY3Rpb25cIixpbWcpO1xyXG4gICAgICB9KVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VuZE1zZyhcIm1zZ1wiLFwiTm8gZnJhbWUgaGFzIGJlZW4gc2VsZWN0ZWRcIik7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4vLyB0b2RvLG11dGlwbGUgc2VsZWN0aW9uXHJcbnZhciBzZWxlY3Rpb25OYW1lID0gJyc7XHJcblxyXG4vLyBNZXRob2QgSUlcclxuZnVuY3Rpb24gcG9zdEltYWdlUHJvbWlzZSgpe1xyXG4gICAgbGV0IG5vZGVzID0gZmlnbWEuY3VycmVudFBhZ2Uuc2VsZWN0aW9uO1xyXG4gICAgY29uc3QgZGF0YUFycmF5ID0gW107XHJcbiAgICB2YXIgaW5kZXggPSAwO1xyXG4gICAgLy8gdG9kbyxtdXRpcGxlIHNlbGVjdGlvblxyXG4gICAgLy9zZW5kTXNnKFwiaXNGaWdtYUVudlwiLHRydWUpXHJcbiAgICBpZiAobm9kZXMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIFxyXG4gICAgICAgIGxldCBmcmFtZU5vZGUgPSBub2Rlc1swXSBcclxuICAgICAgICBzZWxlY3Rpb25OYW1lID0gZnJhbWVOb2RlLm5hbWU7XHJcbiAgICAgICAgLy8gdG9kb1xyXG4gICAgICAgIGZvcih2YXIgYz0wO2M8ZnJhbWVOb2RlLmNoaWxkcmVuLmxlbmd0aDtjKyspe1xyXG4gICAgICAgICAgZnJhbWVOb2RlLmNoaWxkcmVuW2NdLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnJhbWVOb2RlLmV4cG9ydEFzeW5jKHtcclxuICAgICAgICAgIGNvbnRlbnRzT25seTogdHJ1ZSxcclxuICAgICAgICAgIGZvcm1hdDogXCJQTkdcIixcclxuICAgICAgICAgIGNvbnN0cmFpbnQ6IHtcclxuICAgICAgICAgICAgICB0eXBlOiBcIlNDQUxFXCIsXHJcbiAgICAgICAgICAgICAgdmFsdWU6IGV4cG9ydFNjYWxlLFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pLnRoZW4oXHJcbiAgICAgICAgICByZXNvbHZlZCA9PiB7XHJcbiAgICAgICAgICAgICAgZGF0YUFycmF5LnB1c2goXHJcbiAgICAgICAgICAgICAgICB7IFxyXG4gICAgICAgICAgICAgICAgICBuYW1lOmZyYW1lTm9kZS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICB3aWR0aDpmcmFtZU5vZGUud2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgIGhlaWdodDpmcmFtZU5vZGUuaGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICB4OmZyYW1lTm9kZS54LFxyXG4gICAgICAgICAgICAgICAgICB5OmZyYW1lTm9kZS55LFxyXG4gICAgICAgICAgICAgICAgICBpbWFnZURhdGE6cmVzb2x2ZWQsXHJcbiAgICAgICAgICAgICAgICAgIHR5cGU6J2ltYWdlLWZyYW1lbm9kZScsXHJcbiAgICAgICAgICAgICAgICAgIGluZGV4OmluZGV4XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU3VjY2VlZCB0byBzZW5kIGZyYW1lTm9kZSBpbWFnZSFcIilcclxuICAgICAgICAgICAgICBmb3IobGV0IGk9MDtpPGZyYW1lTm9kZS5jaGlsZHJlbi5sZW5ndGg7aSsrKXtcclxuICAgICAgICAgICAgICAgIGZyYW1lTm9kZS5jaGlsZHJlbltpXS52aXNpYmxlID0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgZnJhbWVOb2RlLmNoaWxkcmVuW2ldLmV4cG9ydEFzeW5jKHtcclxuICAgICAgICAgICAgICAgICAgY29udGVudHNPbmx5OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICBmb3JtYXQ6IFwiUE5HXCIsXHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiU0NBTEVcIixcclxuICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBleHBvcnRTY2FsZSxcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkudGhlbiggXHJcbiAgICAgICAgICAgICAgICAgIHJlc29sdmVkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhQXJyYXkucHVzaChcclxuICAgICAgICAgICAgICAgICAgICAgIHsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ZnJhbWVOb2RlLmNoaWxkcmVuW2ldLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOmZyYW1lTm9kZS5jaGlsZHJlbltpXS53aWR0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OmZyYW1lTm9kZS5jaGlsZHJlbltpXS5oZWlnaHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6ZnJhbWVOb2RlLmNoaWxkcmVuW2ldLngsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6ZnJhbWVOb2RlLmNoaWxkcmVuW2ldLnksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlRGF0YTpyZXNvbHZlZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTonaW1hZ2UtY2hpbGRub2RlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6KytpbmRleCxcclxuICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTdWNjZWVkIHRvIHNlbmQgY2hpbGROb2RlIGltYWdlIVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGkgPT09IGZyYW1lTm9kZS5jaGlsZHJlbi5sZW5ndGggLTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2xhc3QgY2hpbGROb2RlIGltYWdlIScpXHJcbiAgICAgICAgICAgICAgICAgICAgICBzZW5kTXNnKFwic2VsZWN0aW9uXCIse2lzRmlnbWE6dHJ1ZSxkYXRhOmRhdGFBcnJheX0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIHJlamVjdGVkID0+IHtcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihyZWplY3RlZClcclxuICAgICAgICAgICAgICAgICAgc2VuZE1zZyhcImZhaWxlZFwiLG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHNlbmQgaW1hZ2UhXCIpXHJcbiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHNlbmQgaW1hZ2UhJyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICByZWplY3RlZCA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihyZWplY3RlZClcclxuICAgICAgICAgICAgICBzZW5kTXNnKFwiZmFpbGVkXCIsbnVsbCk7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzZW5kIGltYWdlIVwiKVxyXG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHNlbmQgaW1hZ2UhJyk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIGVsc2UgaWYobm9kZXMubGVuZ3RoID4gMSl7XHJcbiAgICAgIHNlbmRNc2coXCJmYWlsZWRcIixudWxsKTtcclxuICAgICAgY29uc29sZS5lcnJvcihcIk9ubHkgc3VwcG9ydCBvbmUgZnJhbWUhXCIpXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignT25seSBzdXBwb3J0IG9uZSBmcmFtZSEnKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHNlbmRNc2coXCJmYWlsZWRcIixudWxsKTtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiTm8gZnJhbWUgaGFzIGJlZW4gc2VsZWN0ZWQhXCIpXHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBmcmFtZSBoYXMgYmVlbiBzZWxlY3RlZCcpO1xyXG4gICAgfVxyXG59XHJcblxyXG5maWdtYS5zaG93VUkoX19odG1sX18se3dpZHRoOjkwMCxoZWlnaHQ6Njc1fSk7XHJcbnBvc3RJbWFnZVByb21pc2UoKTtcclxuXHJcbmZpZ21hLnVpLm9ubWVzc2FnZSA9IChtc2cpID0+IHtcclxuXHJcbiAgICBpZihtc2cudHlwZSA9PT0nc2F2ZS1jYW52YXMtaW1hZ2UnKXtcclxuICAgICAgICAvLyBsZXQgZGF0YSA9IG1zZy5ibG9iIGFzIFVpbnQ4QXJyYXlcclxuICAgICAgICBsZXQgZGF0YSA9IG1zZy5ibG9iXHJcbiAgICAgICAgbGV0IGltYWdlSGFzaCA9IGZpZ21hLmNyZWF0ZUltYWdlKGRhdGEpLmhhc2hcclxuICAgICAgICBjb25zdCByZWN0ID0gZmlnbWEuY3JlYXRlUmVjdGFuZ2xlKClcclxuICAgICAgICBjb25zb2xlLmxvZyhtc2cpXHJcbiAgICAgICAgcmVjdC5uYW1lID0gbXNnLm5hbWU7XHJcbiAgICAgICAgcmVjdC5yZXNpemUobXNnLndpZHRoLG1zZy5oZWlnaHQpXHJcbiAgICAgICAgcmVjdC5maWxscyA9IFtcclxuICAgICAgICAgICAgeyB0eXBlOiBcIklNQUdFXCIsIHNjYWxlTW9kZTogXCJGSVRcIiwgIGltYWdlSGFzaCB9LFxyXG4gICAgICAgIF1cclxuICAgICAgICBmaWdtYS5jdXJyZW50UGFnZS5hcHBlbmRDaGlsZChyZWN0KVxyXG4gICAgICAgIGZpZ21hLmN1cnJlbnRQYWdlLnNlbGVjdGlvbiA9IFtyZWN0XTtcclxuICAgICAgICAvL2ZpZ21hLnZpZXdwb3J0LnNjcm9sbEFuZFpvb21JbnRvVmlldyhbcmVjdF0pO1xyXG4gICAgfVxyXG4gICAgaWYobXNnLnR5cGUgPT09J2NhbmNlbCcpe1xyXG4gICAgICAgIGZpZ21hLmNsb3NlUGx1Z2luKCk7XHJcbiAgICB9XHJcblxyXG59O1xyXG5cclxuIl0sIm5hbWVzIjpbImV4cG9ydFNjYWxlIiwic2VuZE1zZyIsInRwIiwidmFsIiwiZmlnbWEiLCJ1aSIsInBvc3RNZXNzYWdlIiwidHlwZSIsInZhbHVlIiwiZ2V0SW1nIiwibm9kZXMiLCJjdXJyZW50UGFnZSIsInNlbGVjdGlvbiIsImxlbmd0aCIsIm5vZGUiLCJpbWciLCJleHBvcnRBc3luYyIsImNvbnRlbnRzT25seSIsImZvcm1hdCIsImNvbnN0cmFpbnQiLCJwb3N0SW1hZ2UiLCJ0aGVuIiwic2VsZWN0aW9uTmFtZSIsInBvc3RJbWFnZVByb21pc2UiLCJkYXRhQXJyYXkiLCJpbmRleCIsImZyYW1lTm9kZSIsIm5hbWUiLCJjIiwiY2hpbGRyZW4iLCJ2aXNpYmxlIiwicmVzb2x2ZWQiLCJwdXNoIiwid2lkdGgiLCJoZWlnaHQiLCJ4IiwieSIsImltYWdlRGF0YSIsImNvbnNvbGUiLCJsb2ciLCJpIiwiaXNGaWdtYSIsImRhdGEiLCJyZWplY3RlZCIsImVycm9yIiwiRXJyb3IiLCJzaG93VUkiLCJfX2h0bWxfXyIsIm9ubWVzc2FnZSIsIm1zZyIsImJsb2IiLCJpbWFnZUhhc2giLCJjcmVhdGVJbWFnZSIsImhhc2giLCJyZWN0IiwiY3JlYXRlUmVjdGFuZ2xlIiwicmVzaXplIiwiZmlsbHMiLCJzY2FsZU1vZGUiLCJhcHBlbmRDaGlsZCIsImNsb3NlUGx1Z2luIl0sInNvdXJjZVJvb3QiOiIifQ==